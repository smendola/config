#!/bin/bash

excl () {
  echo "--exclude-dir" $1 | sed 's/,/ --exclude-dir /g'
}

SHOW=-l

# Process the options
while getopts :x:dc! OPTNAME
do
    case $OPTNAME in
    \?) # Option not recognized
        # GREPOPT="$GREPOPT -$OPTNAME" ;;
        # echo "rgrep: Unknown option $OPTARG" >&2
        # exit 1;;
        ;;
    # Regular options:
    x)    EXCLUDE="$EXCLUDE $(excl $OPTARG)" ;;
    d)    SHOW= ;;
    c)    SHOW=-c ;;
    *)    GREPOPT="$GREPOPT -$OPTNAME" ;;
    esac
done
shift $(( $OPTIND - 1 ))

INCLUDE=
if [[ ! -z $2 ]]
then
    INCLUDE="--include ${2}"
fi

set -x
/usr/bin/rgrep --color=AUTO $EXCLUDE $INCLUDE "$1" $SHOW $GREPOPT .
